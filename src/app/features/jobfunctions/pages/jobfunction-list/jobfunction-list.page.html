<app-top-page
  title="Funções"
  icon="pi pi-briefcase"
  [showAdd]="true"
  addLabel="Nova"
  [addLink]="['/admin/empresa', companyId, 'setores', sectorId, 'funcoes', 'criar']"
  [showBack]="true"
  [backLink]="['/admin/empresa', companyId, 'setores']">
</app-top-page>

<section class="page-shell">
  <div class="table-card">
    <div class="table-header">
      <div>
        <p class="eyebrow">Registros</p>
        <h3>Funções</h3>
        <p class="subtitle">Edite ou remova funções deste setor.</p>
      </div>
    </div>

    @if (!loading()) {
      <div class="table-scroll">
        <p-table
          [value]="jobFunctions"
          class="accent-table"
          [paginator]="false"
          [rows]="10"
          responsiveLayout="scroll"
          [loading]="loading()">

          <ng-template pTemplate="header">
            <tr>
              <th>Nome</th>
              <th>Descrição</th>
              <th class="align-right">Ações</th>
            </tr>
          </ng-template>

          <ng-template pTemplate="body" let-row>
            <tr>
              <td>{{ row.name }}</td>
              <td>{{ row.description }}</td>
              <td class="action-col">
                <button
                  pButton
                  icon="pi pi-pencil"
                  class="p-button-text action-btn"
                  [routerLink]="['/admin/empresa', companyId, 'setores', sectorId, 'funcoes', 'editar', row.id]">
                </button>
                <button
                  pButton
                  icon="pi pi-trash"
                  class="p-button-text p-button-danger action-btn"
                  (click)="openDeleteConfirm(row)"
                  [disabled]="deletingId === row.id"
                  pTooltip="Remover função" tooltipPosition="top" appendTo="body">
                </button>
              </td>
            </tr>
          </ng-template>

          <ng-template pTemplate="emptymessage">
            <div class="empty-state">
              <i class="pi pi-briefcase"></i>
              <p>Nenhuma função cadastrada.</p>
              <span>Adicione uma função para este setor.</span>
            </div>
          </ng-template>

        </p-table>
      </div>
    } @else {
      <div class="table-skeleton">
        @for (_ of [1, 2, 3, 4, 5]; track _) {
          <div class="skeleton-row"></div>
        }
      </div>
    }
  </div>

  @if (showConfirmModal) {
    <div class="confirm-overlay" (click)="closeDeleteConfirm()">
      <div class="confirm-dialog" (click)="$event.stopPropagation()">
        <div class="dialog-icon">
          <i class="pi pi-exclamation-triangle"></i>
        </div>
        <div class="dialog-body">
          <p class="eyebrow">Confirmação</p>
          <h3>Remover {{ selectedName || 'função' }}?</h3>
          <p class="subtitle">Esta ação é definitiva. Confirme para seguir.</p>
        </div>
        <div class="dialog-actions">
          <button pButton class="p-button-text" type="button" (click)="closeDeleteConfirm()">
            Cancelar
          </button>
          <button
            pButton
            type="button"
            icon="pi pi-trash"
            class="p-button-danger"
            (click)="confirmDelete()"
            [disabled]="deletingId === selectedId">
            Remover
          </button>
        </div>
      </div>
    </div>
  }
</section>


